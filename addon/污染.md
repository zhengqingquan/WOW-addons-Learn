alse see：
    https://wowpedia.fandom.com/wiki/Secure_code
    https://wowpedia.fandom.com/wiki/Secure_Execution_and_Tainting
    https://wowpedia.fandom.com/wiki/Category:API_functions/Protected
    https://www.townlong-yak.com/bugs/PfF9rr-UIDropDownMenu
    https://www.townlong-yak.com/taint.log/about.html
    https://www.townlong-yak.com/bugs/PfF9rr-UIDropDownMenu

Secure code
安全代码：
安全代码拥有调用受保护程序的特殊权限。所有的暴雪代码都是安全的，除非它被非安全代码污染(通常通过钩子)。从暴雪的安全框体模板创建的框体也是安全的。

Secure Execution and Tainting
安全执行和污染
用户界面API从不安全或污染的使用中保护一些功能来授权人们的决策（human decision-making，这里指代的是游戏中的动作，例如角色走动或释放技能），特别是在战斗中。这种安全模式主要在2.0的补丁中引入，并且从那时起一直是API的基石。


Taint
污染
当《魔兽世界》开始执行Lua代码时，执行从“secure(安全)”开始，并且能够在所有情况下运行受保护功能。执行保持安全，直到遇到“taint(污点)”——这表明函数或对象来自不受信任的地方（插件或脚本——addon或/script）。基本思想是，一旦读取第三方引入的数据或代码，执行就会“被污染(tainted)”，并且任何已经被污染的执行写入的新数据也会被污染。如果插件将污染传播到重要的游戏功能，它将阻止它们工作（尤其是在战斗中）。在玩家重新登录或重载界面之前，污点（taint）会一直存在，这可能会造成严重的后果，因为如果受保护的功能检测到潜在的不安全路径，它们将会拒绝运行。
当UI首次加载时，来自暴雪签名的FrameXML和插件（以及它们保存的变量）的所有代码和数据都是安全的，并且来自第三方插件（以及他们保持的变量）的所有代码都是受到污染的。

What can be tainted?
什么可以被污染？
所有Lua值和引用都可以被污染——局部变量、全局变量、表键、表值：
1、当新变量被创建（例如local x = 2），他们将继承其执行路径的当前污染。
2、当代码访问安全值时，结果变量将被当前路径污染（但原始变量的值保持干净）。
3、当代码访问被污染的值时，结果值将保持被污染，执行路径也被污染。
4、当代码设置全局变量时，结果值具有执行路径的污染。
函数闭包也可以被污染，执行函数闭包会将其污染引用到当前环境。


Securely post-hooking
安全后钩
污染是第三方插件固有的，但API提供了两个强大的功能来避免将污染传播到受保护的游戏功能：
hooksecurefunc(["table"], "name", func) ：插件可以后钩（post-hook）一个安全的全局函数，插入自己的自定义函数，在原始函数之后执行。它接收与原始参数相同的参数的副本，但放在后面执行以防止污染原始参数。

与SetScript()类似，但自定义函数只在其函数之后执行；同样接收相同的参数，但不会将污染传播到已经完成的部分。

Protected frames and secure templates
受保护的框架和安全模板
《魔兽世界》2.0还引入了新的Frame概念，受保护框体（protected frames），还可以在战斗中绕过交互限制。但是，需要注意的是，这些必须在脱离战斗时使用预定义的属性创建和预编译。战斗开始后，游戏将根据之前设置的任何属性管理显示、隐藏、调整大小和定义框架。这些属性允许一些逻辑，但仅限于确保实际人们参与的一些狭义规则。尽管如此，安全代码是一种特殊情况，可以绕过这些限制，在战斗中获得额外（但仍然有限）的功能。
一旦一个框体被声明为受保护，它就不能被取消保护，保护通常是从专门设计的模板继承的，例如SecureTemplates（2.0补丁中引入的基本功能）和SecureHandlers（3.0补丁中引入的扩展功能）。
对受保护框架的控制限制也适用于他们的父框体和他们锚定到的任何框体。这在受保护的框体锚定到另一个通常不受保护的框体时很重要，因为它可能导致意外且不受欢迎的行为。这种传播是暂时的，在战斗之外重新锚定或重新设置框体可以解除限制。
受保护的框体很重要，意外它们构成了暴雪的行动和施法按钮的基础，还因为它们允许一些新的安全按钮模板。由于普通的插件代码被污染，它不饿能直接改变目标或执行动作，但是《魔兽世界》2.0包含许多可以被插件代码继承的安全模板。这些安全模板提供了一个或多个安全处理程序，通常是OnClick,它们使用框体属性来执行操作。当一个安全模板被继承时，它定义的任何处理程序都保持安全，除非它们被继承框体（或另一个模板）覆盖。
使用与每个模板相关的frame:SetAttribute()方法配置安全模板，但仅限于战斗之外。在创建安全框体、设置其属性或重新配置其属性之前，附加组件应检查InCombatLockdown()
