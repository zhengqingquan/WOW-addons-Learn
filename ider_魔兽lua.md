有四本书可以用来学习：分别是
《World of Warcraft Programming: A Guide and Reference for Creating WoW Addons》
《World of Warcraft Programming: A Guide and Reference for Creating WoW Addons (second edition)》
《Beginning Lua with World of Warcraft Addons》
《Hacking World of Warcraft》
这几本书都是在巫妖王时期，有的在巫妖王早期，有的在末期（正是我们当时的巫妖王早期）。前面两本书的销售网站：[World of Warcraft Programming](https://wowprogramming.com/)


插件主要由三种文件构成，用于描述的toc文件，用于实体定义的xml文件和脚本执行主体的lua文件。
toc主要用来描述插件本身的属性，如插件版本，作者，修改日期以及依赖。
xml用来指定要显示界面样式和风格。xml可以用来定义插件在游戏中的界面及处理的逻辑，但现在慢慢由lua的函数库取代了，xml的作用没那么大了，可以用来做配置文件。
界面事件可以交给lua脚本处理。lua为具体的实现，修改插件的功能就是修改它的lua脚本文件。
wow是基于事件处理编程的，即当某一事件发生以后，所有需要捕获该事件的代码都会被触发（响应）。


### toc文件
toc文件承载着插件的一些基本信息。它为《魔兽世界》客户端调用你插件的脚本提供类似“索引”或“说明”的相关内容。一个常见的toc文件通常包含以下内容：
`##`是客户端调用的标签。若你需要在toc文件中使用备注或者注释，可以使用单个`#`进行说明。

`Interface` - 标记该插件用于wow的哪个游戏版本，如果标记值低于当前游戏版本将不能被加载，除非用户选择加载过期插件，所以，大版本更新时，最好修改这个标记值来符合新的游戏版本，可以在进入游戏后使用宏来获得当前游戏的版本号： /run print((select(4, GetBuildInfo())))
`Title` - 插件的名称，不需要和插件名一致，会被显示在选择人物界面的插件列表中。如果需要实现不同语种的客户端显示不同的文字的话(本地化机能)，可以修改标签名，在标签名后加上一个"-"，再跟上客户端的语种名就可以了，比如国服的实际标签名： Title-zhCN。如果客户端的语种对应的标签不存在，那么就使用默认的Title标签的值。
`Notes` - 在插件列表中，鼠标移到插件名称上时显示的提示信息。同样，可以用类似-zhCN这样的后缀来做本地化申明。
`RequiredDeps`, `Dependencies`, `或者任意以 "Dep" 开始的字符串` - 一些以逗号分割的其他插件的名字，表示本插件必须在这些插件都存在，且都已经被加载的情况下，才能被加载，也就是插件依赖。
`OptionalDeps` - 一些以逗号分割的其他插件的名字，表示如果这些插件存在，那么这些插件需要在本插件加载前，被加载，可选依赖。
`LoadOnDemand` - 如果这个值被设置为1，那么这个插件不会在游戏开始时就加载，而是由其他插件在需要时，另行加载，wow自带的一些插件都是如此设置的。
`LoadWith` - 一些以逗号分割的其他插件的名字， 如果本插件的LoadOnDemand为1，那么，当这些插件在游戏开始被加载时，也加载本插件。
`LoadManagers` - 一些以逗号分割的其他插件的名字， 如果这些插件都不存在，那么客户端会自动加载本插件，如果这些插件中的一个存在，那么，本插件将按照LoadOnDemand设置为1的情况处理。
`SavedVariables` - 一些以逗号分割的变量名称，这些变量一般是保存在游戏中的Lua全局环境中的表，这些变量的值在退出游戏时将被保存到硬盘上，在下一次游戏开始再被加载进入游戏，可以用来保存用户的配置信息等。这些变量的值对同一账户在同一服务器的所有角色都是通用的。
`SavedVariablesPerCharacter` - 类似SavedVariables，不过，每个角色都有各自不同的变量值，也就是说，SavedVariables适合保存通用配置，SavedVariablesPerCharacter适合保存个人配置。
`DefaultState` - 本插件安装后默认是否开启，如果设置成 "Disabled"，那么只有在插件列表中勾选本插件后，才会被加载。默认值 "Enabled"
`Author` - 作者名字
`Version` - 插件自身的版本号

你也可以自己定义标签，让其他查看toc文件的人员简单了解你的插件信息。

```
# 插件使用的游戏版本，《魔兽世界》客户端用这一项判断插件是否过期。
## Interface: 11302

# 插件的名字，这个插件叫做oHWell。
## Title: oHWell

# 插件的说明与备注，主要用来说明插件的功能
## Notes: Dismount, cancel form, stand up

# 插件自身的版本。
## Version: C1.2

# 插件的作者。
## Author: EK

# 该插件安装后默认是否开启，默认值为"Enabled"。
## DefaultState: Enabled

# 插件用于保存游戏数据的文件名。
## SavedVariables: TestAddonSave
```

在8.1之后暴雪更改了文件夹结构，把ptr、正式服、和怀旧服分开了。


下载插件是用粘贴似乎是用粘贴覆盖的方式。

插件并不一定需要xml文件。例如有个插件idTip。它就只有三个文件，其中一个还是自述文件。

开发插件最困难的不在于有没有点子，而在于你如何找到合适的东西去构建你的点子。
这其中最困难的是使用魔兽的api

而最好的方法是去看看别人怎么使用的。
最好找一些没使用库的插件。

又个问题是，你如果用插件修改了某个东西，它可能无法再变回来了。（除非你重新装游戏）。例如你修改了某些地方的提示信息。

先找一些不需要参数的方法看。再找一些只有一个参数的看。

魔兽中有一个很重要的hooksecurefunc()方法。会再要hook的函数执行即将结束时该传入参数传递到你提供的functon中。
更简单的说法是绑定一个新函数到旧函数之后运行。参数与旧函数相同，但返回值会被忽略。
一般用来增强原函数，或者重写原函数的部分功能。比如自带任务列表文字修改，染色什么的都是属于在暴雪UI做完操作后，再修改到我们想要的样子。
http://wowwiki.wikia.com/wiki/API_hooksecurefunc

魔兽的框架是具有ID的，例如windows的句柄。


插件SimulationCraft虽然用到了很多库，但还是一个不错的可以用来学习的插件，因为它足够简单。


	
Extended Vendor UI插件和already knows插件有冲突。
但already knows本身不会显示背包中已经学习的图纸
Extended Vendor UI已经有一个大版本没有更新了


创建框体需要材质（texture）
框架不能删除，尽量重用框架。

用CreateFrame定义框体Frame
https://wowpedia.fandom.com/wiki/API_CreateFrame

往定义的框体Frame添加材质，具体的一些Frame在这里。
https://wowpedia.fandom.com/wiki/UIOBJECT_Frame

大体上有两种方法可以创建框体，一个是XML一个是Lua。


魔兽的插件是按顺序从上到下载入的。local只会在自己的插件中属于自己的作用域。而全局变量所有的插件都可以调用和修改。


为了安全和限制过分的自由，在《魔兽世界》中，插件被分为安全插件和非安全插件。《魔兽世界》自带的插件都是属于安全插件。如果玩家插件Hook了安全插件的函数，那么就会因为安全插件的污染导致出错。所以，原则上，我们是不能针对WOW自带的插件使用Hook技术的。但我们可以针对第三方的插件使用。当然也可以对lua高级语言自身使用。


可以通过/console taintLog 1来开启污染日志，也可以通过/console taintLog 0

暴雪提供了一个宏，/fstack，在聊天框输入这个宏后，鼠标可以移动到界面上，就会提示当前frame的名字（只针对全局的frame，局部frame的名字是动态生成的，所以可能是一堆数字之类的，那种就不行了）

有两种常用的定位方式，一种是绝对定位，另一种是相对定位（偏移量）。
绝对定位用的是指定某个点与某个点的距离，如框体左上角的点和魔兽屏幕窗体左上角的点的距离。
相对定位是两个框体，的某个点对应，再移动偏移量。


带参数运行插件，-console，在魔兽控制台下输入“exportInterfaceFiles code”或 “exportInterfaceFilesart”。在BlizzardInterfaceCode 目录在找到相关文件。



WTF文件，有一个文件和两个文件夹，其中客户端范围内的大部分变量可以在Config.wtf中找到。而魔兽账户范围内的变量可以在Account\账户#子账号\ config-cache.wtf中找到。特定与字符的变量可以在\World of Warcraft\_retail_\WTF\Account\<AccountName>\<Server>\<Character>\config-cache.wtf下找到。



wow每次只能读取1024字节，富裕出的部分将被忽略且不报错。


编辑toc文件必须重启游戏，编辑lua和xml可以不用。xml中可以调用lua文件。lua文件嵌入式脚本语言。在wow中实现.xml调用的函数。
绑定文件：
内容文件：


CVar控制台参数


/eventtrace（宏事件跟踪），/etrace

/dump

/reload 原名为/script ReloadUI()

安装wowlua插件后，在魔兽中使用/wowlua或/lua打开wowlua编辑器。可以使用/wowluarun或/luarun从命令行运行WowLua页面。每个斜杠命令使用页面名称，并将任何问题或活动打印到聊天框架。因此可以从宏中使用它们
身上各个部位编号：
1：头
2：颈
3：肩
4：衬衣
5：胸
6：腰带
7：腿
8：脚
9：手腕
10：手套
11：手指1
12：手指2
13：饰品1
14：饰品2
15：背
16：主手
17：副手
18：远程武器

动作条编号：
主动作条1为 1--12
主动作条2为13--24
主动作条3（右1）为25--36
主动作条4（右2）为37--48
主动作条5（右下）为49--60
主动作条6（左下）为61--72

背包及包裹格子编号：
背包从右到左的编号分别是：4、3、2、1、0~
包裹格子的编号是从左至右排列，一个包的第一行分别是：1、2、3、4~
然后是包裹第2行：5、6、7、8~下面几行依次类推。

https://wow.gamepedia.com/Ace_(AddOns)
Ace是一个用于创建魔兽世界插件的轻量级而且强大的系统。这是插件开发的一种新方法，是从头开始的重新思考。
Ace为开发人员提供了大多数开发插件所需的工具，将他们从重复的常见任务中解放出来，并允许他们直接进入构建他们插件创造性的部分。无论新手还是有经验的插件开发者都可以从Ace的特性中获益。

Ace的设计理念
Ace最初的设计理念很简单：少即是多。它的意思是更少的代码，更少的资源使用，更少的努力设计一个插件，更少的压力在UI上。Ace的关注着效率的方方面面，不仅是在代码设计方面，更是确保只使用必要数量的内存和处理来执行给定的任务。
Ace试图将这些知识整合到一个中心资源中，为开发人员提供一个完整的易于使用的插件框架，它非常的灵活，而且非常强大。这个框架提供了插件所需的最常见的组件，如数据管理和聊天命令处理，它还提供了一个glue机制（胶粘机制），将插件链接在一起，并且允许他们能够平稳有效地共享系统资源。

https://wow.gamepedia.com/Ace2
与Ace一样，Ace2的主要目的（正如https://www.wowace.com/所描述的）是提高模块化、提高性能并简化插件和库创建过程。
Ace2在达到黄金状态时取代Ace。但目前Ace2已经处于生命尽头的状态，并且被Ace3取代。

需要注意的是如果你的插件本地化的话，本地化文件要写在你要汉化的lua之后。



为了满足用户和开发人员的不同需求，魔兽世界的API一直在不断地变化，以达到某些个人或群体的使用目的。因此，任何引用API的文献教程或参考网站都会随着时间的推移而慢慢过时（包括现在的9.0.2，也会在将来因某个补丁而导致该版本过时）。或许得到这样的消息会让你感到失落，甚至没有想继续学习下去的动力，因为过时的东西可能都还没学会，而新的东西就如海啸般向你涌来，甚至光去找最新的资料就已经花了你大量的时间和精力。这种挫败感令人让人容易放弃。但这是有办法来降低你的挫败感的，比如在这个大版本刚更新完，整个版本慢慢趋于稳定的时候来学习它。仔细一想，你有整整一个大版本来学习它。还有一种方法，就是有人来整理和列出最新的暴雪API引用网站和材料，因为大多是国外网站，不花点力气还真是不好找。最后也最重要的是，你需要知道一点，你学习的速度远远快于那些程序员的更新速度。就像我写到这足足花了我20分钟，而你阅读可能只花了1分钟。
还有一点你必须知道，魔兽的高度定制化UI归功于这些庞大的API，但你并不需要全部了解它们，你只需要能在短时间内找到并使用它们就已经足够优秀。而如何完成一个优秀的插件取决于你的编程经验和技巧，但即使你没经验也可以通过看别人的插件来构建你自己的插件，没技巧也可以只使用简单if-elseif-else-end块来写一个完整的功能模块。
早在上个时期，在interface下面有多个文件夹


我不讲Lua基础，这部分既乏味，又对你没有任何帮助。






开发工具的选择上：
有Sublime3
http://www.sublimetext.com/

有EditPlus
https://www.editplus.com/

有vscode
推荐使用vscode

甚至vs（但我没有成功）


查找事件（通常用宏先查看是什么事件）
https://wow.gamepedia.com/


查看暴雪的本地化翻译是如何处理的。
https://www.townlong-yak.com/framexml/36949/GlobalStrings.lua/CN


### 转义字符

&emsp;&emsp;使用字符串拼接的主要问题不仅在于比较难看，而且实际上因为创建了是三个字符串，效率也低。转义字符的书写也比较简单，以 "\" 开始即可。

`\a` bell -- 系统自带的扬声器（或蜂鸣器）会发出“叮”的一声
`\b` back space -- 后退
`\f` form feed -- 换页
`\n` newline -- 换行
`\r` carriage return -- 回车
`\t` horizontal tab -- 制表
`\v` vertical tab -- 制表
`\\` backslash -- "\"
`\"` double quote -- 双引号
`\'` single quote -- 单引号
`\[` left square bracket -- 左中括号
`\]` right square bracket -- 右中括号



### 模式（pattern）

"%d" 这种被称为字符类，也就是一组字符的集合，"%d"可以匹配这个集合中的任意元素，具体看看，可用的字符类，数量不是很多：

`.` -- 任意字符
`%a` -- 字母 `%A` -- 非字母
`%c` -- 控制字符 `%C` -- 非控制字符
`%d` -- 数字 `%D` -- 非数字
`%l` -- 小写字母 `%L` -- 非小写
`%p` -- 标点字符 `%P` -- 非标点符号
`%s` -- 空白符 `%S` -- 非空白符
`%u` -- 大写字母 `%U` -- 非大写
`%w` -- 字母和数字 `%W` -- 非字母非数字
`%x` -- 十六进制数字 `%X` -- 非十六进制数字(0-9， a-f)
`%z` -- 代表0的字符(ASCII编码是0的字符，一般不会使用到) `%Z` -- 非编码为0的字符

在字符类 "%d" 后面使用的“+" 号被称为修饰符号，同样也有多种：

`+` -- 匹配前一字符 1 次或多次，最长匹配，能匹配多少就匹配多少，也就是优先度高
`*` -- 匹配前一字符 0 次或多次
`-` -- 匹配前一字符 0 次或多次，最短匹配，优先度低，如果匹配的字符也能被前后的模式匹配到，那么就不匹配。
`?` -- 匹配前一字符0次或1次


### 环境
_G是一个公共环境表。lua自带的api函数也都保存在这里面，它也是默认环境表。
环境的意思，是我们访问和保存的全局表量实际都是在一个环境中进行的，也就是说这些全局变量都不过是这个表的字段。环境 == 表，这是lua的一个重要设计，也使lua能够用简单几个数据类型构建起复杂的系统。